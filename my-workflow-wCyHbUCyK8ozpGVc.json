{"createdAt":"2025-07-04T18:42:57.928Z","updatedAt":"2025-07-05T10:37:32.000Z","id":"wCyHbUCyK8ozpGVc","name":"My workflow","active":false,"isArchived":true,"nodes":[{"parameters":{"method":"POST","url":"https://app.enterprisetecno.com/api/messages/send","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer fzaUbrEvm8RvfJ5c9pIQtOrQEtNInB"},{"name":"Content-Type","value":"multipart/form-data"}]},"sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Edit Fields').item.json.number }}"},{"name":"body"},{"name":"sendSignature","value":"false"},{"name":"closeTicket","value":"false"},{"parameterType":"formBinaryData","name":"medias","inputDataFieldName":"=data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2720,360],"id":"6aaccac4-9f53-4bed-bfd9-ae0c09adc38a","name":"HTTP Request","notesInFlow":false},{"parameters":{"operation":"executeQuery","query":"{{ $fromAI(\"query\") }}","options":{}},"type":"n8n-nodes-base.postgresTool","typeVersion":2.6,"position":[1420,660],"id":"60f41cc3-3389-4f6d-ac46-e2d7d7cab9c9","name":"Postgres1"},{"parameters":{"mode":"retrieve-as-tool","toolName":"documents_eccomerce","toolDescription":"Vector Database","tableName":{"__rl":true,"value":"documentos","mode":"list","cachedResultName":"documentos"},"topK":50,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.1,"position":[1040,700],"id":"98eeff0f-dd7d-40ee-9f2d-7be7dffe050c","name":"Supabase Vector Store1"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[940,940],"id":"ff0e41f8-471b-4e3f-aeca-812b26166432","name":"Embeddings OpenAI1"},{"parameters":{"httpMethod":"POST","path":"664fe8e3-504f-479b-8282-c1f16c2a3bce","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-800,320],"id":"d9138e33-8273-49d2-a91a-4d24f458da07","name":"Webhook","webhookId":"664fe8e3-504f-479b-8282-c1f16c2a3bce"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('Mapeo de mensaje').item.json.mensaje }}","tableName":"=n8n_chat_histories_cliente","contextWindowLength":50},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[800,720],"id":"479d69f1-45f0-48b6-935f-a38480efb1ee","name":"Postgres Chat Memory"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{"temperature":0.1}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[640,680],"id":"480f01dc-68e0-4e19-9737-0424bddb881d","name":"OpenAI Chat Model"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.type }}","rightValue":"=ptt","operator":{"type":"string","operation":"equals"},"id":"be9dbcd5-0882-4ce9-9822-305865fae492"}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"6a0ec742-7f93-4ea1-af39-35d410da1c1a","leftValue":"={{ $json.type }}","rightValue":"text","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"texto"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-280,320],"id":"0c28a8d4-a958-4da0-a675-bd4cfbce6bff","name":"Switch"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[440,180],"id":"a1fb111e-18d8-4dff-9601-81e083abae8d","name":"OpenAI1"},{"parameters":{"assignments":{"assignments":[{"id":"9ab83bb8-0010-4684-ae19-79e992cb39ea","name":"body.data.message._data.id.remote","value":"={{ $json.body.key.remoteJid }}","type":"string"},{"id":"26e6f1fb-f66d-4080-a01e-9e889cb2156e","name":"body","value":"={{ $json.body }}","type":"object"},{"id":"3bb7dbe4-91dd-4a12-bd99-45e93aa22d1c","name":"type","value":"={{ \n  $json.body.message.audioMessage ? \"ptt\" : \n  $json.body.message.conversation ? \"text\" : \n  \"unknown\" \n}}","type":"string"},{"id":"d7019858-56db-4b8e-9223-37673b4603cc","name":"number","value":"={{ $json.body?.key?.remoteJid?.includes('@s.whatsapp.net') ? $json.body.key.remoteJid.replace('@s.whatsapp.net', '') : $json.body?.key?.remoteJid || '' }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-560,320],"id":"cb7d248f-6f3f-4582-a1c8-630e7d9c6543","name":"Edit Fields"},{"parameters":{"content":"## Primero configuramos la entrada de información y setteamos ciertos campos que necesitaremos más adelante","height":180,"width":400},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-840,100],"id":"ec1ca162-09b8-4b66-8769-d2ca0f376592","name":"Sticky Note"},{"parameters":{"content":"Ahora lo que hacemos es identificar si la información recibida viene en forma de texto o audio","height":100,"width":220,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-320,200],"id":"18464a54-bc6e-45aa-8d33-ca390bd6fb22","name":"Sticky Note1"},{"parameters":{"content":"## Aquí ocurre la magia. el agente interpreta la información, accede a sus herramientas (base de datos vectorial en este caso) y devuelve una información.","height":120,"width":880,"color":3},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[680,200],"id":"9495345b-9c05-4dae-8e06-30dd17840c58","name":"Sticky Note2"},{"parameters":{"content":"Aquí el audio se convierte el Base64 del audio en un archivo y se descarga en N8N, entonces N8N tiene acceso al archivo y es capaz (mediante un nodo de Transcribe Recording de OpenAI) de transcribir ese audio. Pasar de Audio a Texto","width":300,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0],"id":"abdc6c23-ab71-42ca-bf41-4a9f182d431c","name":"Sticky Note3"},{"parameters":{"assignments":{"assignments":[{"id":"b07077dc-5641-4175-8dc1-faf1f795c679","name":"mensaje","value":"={{ $json.body.message.conversation }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[660,340],"id":"ffd1c019-e9aa-4fc7-8ff0-72b116ff39ed","name":"Mapeo de mensaje"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.content }}","rightValue":"Texto","operator":{"type":"string","operation":"equals"},"id":"885de69c-8001-421f-ad5e-304003d8106b"}],"combinator":"and"},"renameOutput":true,"outputKey":"Texto"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"1c5b603c-3721-480a-a0ef-97091417afbb","leftValue":"={{ $json.message.content }}","rightValue":"Audio","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"Audio"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[2020,340],"id":"e5886d45-099b-4ed0-a94f-7bd54a3d248d","name":"Switch1"},{"parameters":{"method":"POST","url":"https://app.enterprisetecno.com/api/messages/send","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"},{"name":"Authorization","value":"Bearer fzaUbrEvm8RvfJ5c9pIQtOrQEtNInB"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"number","value":"={{ $('Edit Fields').item.json.number }}"},{"name":"body","value":"={{ $('Agente Laura').item.json.output }}"},{"name":"userId"},{"name":"queueId"},{"name":"sendSignature","value":"false"},{"name":"closeTicket","value":"false"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2380,100],"id":"5215ed09-6501-42ab-86fa-1cb55786608b","name":"HTTP Request1"},{"parameters":{"content":"Este GPT considera si la respuesta debe enviarse en formato audio o formato texto","height":80,"width":280,"color":2},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1640,220],"id":"7a02071f-b718-42fa-b491-163114f2eb8b","name":"Sticky Note6"},{"parameters":{"promptType":"define","text":"={{ $json.mensaje }}","options":{"systemMessage":"=Eres una experta en Ventas de calzado que vende botas baqueras.\nTu nombre es Laura.\nUsa emojis para ser llamativa.\nAl principio de la conversación se saluda al cliente y se le pregunta si desea saber más sobre las botas vaqueras. recuerda que manejamos solo el color marron y negro\nDespués de la presentación sólo haz una pregunta por respuesta para no abrumar al cliente.\nsi el cliente pregunta que si es solo de mujer le dices que es unisex es tanto para hombres como para mujeres\nUna vez el cliente responde que quiere saber más sobre las botas vaqueras es muy importante preguntar en qué ciudad se encuentra para validar que tengamos envío gratis contra entrega.\nDespués de que el cliente menciona la ciudad confírmale que tenemos envío GRATIS contra entrega y muy importante proceder a compartir los precios y hacer preguntas durante el chat que eleven el nivel de conciencia del cliente para cerrar la venta.\nsi el cliente te pregunta por más colores dile que manejamos en marron y negro pregúntale ¿cual le gusta más?\nSi el cliente solicita que le envien fotos, foto, catálogo o catalogo y en el contenido del mensaje existen estas palabras sin importar si esta escrita con mayusculas o minusculas, deja que el flujo de Make envie las fotos, no responda nada adicional a este mensaje, tampoco envíe los enlaces de las imagenes, solo continúa la conversación con el cliente, \nNunca envíe enlaces o links de las imagenes al cliente\nSi el cliente desea hacer un pedido, finaliza la conversación agradece por la compra y solicita directamente los siguientes datos:\nCuando un cliente exprese interés en realizar su pedido, solicita amablemente la siguiente información para procesar su pedido:​\nNombre completo\nTeléfono\nCiudad\nDepartamento\nDirección completa\nTalla\nColor\nCantidad\nNota: Importante, la dirección debe estar completa (al menos que tenga calle o carrera) para poder hacer el pedido sino no se puede ya que la transportadora pide dirección completa.\nUna vez que el cliente proporcione todos estos datos, responde con un mensaje de agradecimiento, informándole que su pedido está siendo procesado y que en breve recibirá el número de guía de envío y los detalles del pedido a través de WhatsApp. Mantén un tono cordial, profesional y enfocado en brindar una excelente experiencia de compra.\nSi el cliente desea reclamar en oficina por Interrapidisimo muy importante no debes pedir dirección (ni carrera ni calle) ya que no es necesario cuando es para reclamar en oficina y agradece la compra y finaliza el pedido.\nSi el cliente desea reclamar en la Oficina de Interrapidisimo, o expresa la idea que desea que sea entregado en esta oficina de su ciudad, coloca esta información como Dirección Completa, y confirma la ciudad y el departamento para que sea entregado correctamente\nSi el cliente desea reclamar en oficina de Servientrega dile que no tenemos convenio de envíos con Servientrega, solo puede reclamar en una oficina de Interrapidisimo.\nEl barrio es opcional, si el cliente no lo menciona no lo pidas.\nVe agregando la información a medida que la va proporcionando para completar el pedido. Una vez el cliente proporciona los datos necesarios (sin necesidad de los opcionales) agradece directamente por la compra y dile que Ya mismo subiremos tu pedido y apenas se genere la guía de envío te la estaré compartiendo. Por favor, está pendiente del teléfono y asegúrate de tener el pago listo para el mensajero y desea un excelente día.\nSi el cliente está enviando los datos, le envías un resumen para que sepa cuál dato le falta, es indispensable que los datos del pedido sean los más exactos para no tener problemas con la transportadora.\nCuando el cliente entregue todos los datos para realizar el pedido envía el resumen de la siguiente forma sin guiones o asteriscos tampoco le coloque caracteres especiales:\nNombre completo:\nTeléfono:\nCiudad:\nDepartamento:\nDirección completa:\nTalla:\nColor:\nCantidad:\nagradece directamente por la compra y dile que Ya mismo subiremos tu pedido y apenas se genere la guía de envío te la estaré compartiendo. Por favor, está pendiente del teléfono y asegúrate de tener el pago listo para el mensajero y desea un excelente día.\n\n\n\nInformación General:\nla Bota es %100 cuero de excelente calidad, ciento por ciento cuero y suela pvc cocida  ultra resistente , no es en cuerina sino 100 % cuero  ideal para todo tipo de trabajo. Elaboradas con la mejor tecnología de punta en cuero con los mejores acabados.\nEspecificaciones de las botas en cuero nobuck: Suela pvc, material cuero, suela en  pvc  duradero. Es un material resistente, ideal para trabajo en campo y ciudad. Acabados de excelente calidad.cuenta con excelente acabados y excelente costuras!. \nTallas disponibles:  36 a la 44.\nSuela : Spanson ultra resistente con refuerzo cosido para mayor durabilidad\nMaterial: cuero.\nColores : Marron y Negro \n\nTabla de tallas de las botas en cuero:\n23 centímetros para la talla 36.\n24 centímetros para la talla 37.\n25 centímetros para la talla 38.\n26 centímetros para la talla 39.\n27 centímetros para la talla 40.\n28 centímetros para la talla 41.\n29 centímetros para la talla 42.\n30 centímetros para la talla 43.\n31 centímetros para la talla 44.\n\n-OFERTAS DEL DÍA-\nAntes $134.00 Ahora 1x $117.000  pesos  con ENVÍO GRATIS\nMedio de pago principal contra entrega. Si deseas pagar anticipadamente se le enviará en número de cuenta al Nequi: 3105901444 la persona debe enviar comprobante de pago o de lo contrario será contra entrega\n \n # CUENTA DE AHORROS BANCOLOMBIA 01535325894\nambas cuentas bancarias están a nombre de Daniel Esteban Perez\nLos envíos tardan de 2 a 4 días para ciudades capitales y 5 días hábiles para municipios en promedio.\nLos envíos a Medellín duran de 1 a 2 días y las capitales principales de Colombia duran 3 días hábiles. En municipios o otros lugares de Colombia donde exista cobertura el tiempo de entrega es de 3 a 5 días hábiles sin contar sábados, domingos y festivos.\nSi un cliente ya recibió el producto y no está satisfecho, informar amablemente a que espere por resultados. (No ofrecemos devolución del dinero, esto mencionarlo solo si el cliente pregunta).\nInformar al cliente que el producto entregado es el correcto junto con su presentación y que es un producto original y respaldado por expertos.\nSi el cliente pregunta hasta cuando la promoción le dices que se acaba en 24 horas, después llegará a su precio normal que es un 40% más alto.\nSi el cliente pregunta cuánto es la garantía del producto le dices que es de 4 meses.\nSi te piden precios mayoristas o para negocio, debes enviar el siguiente mensaje: Para una cotización como mayorista, escríbenos aquí: https://wa.link/9uc1cg\nSi el cliente pregunta que si son originales le dices que es producto nacional Diseño moderno, originales de propiedad de la marca\nSi el cliente pide número de guía informa que apenas la tengas disponible se la envías.\n¿En dónde están ubicados?: Estamos ubicados en la ciudad de Medellín, pero nuestra tienda es virtual, hacemos envíos a todo el país\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.8,"position":[1020,340],"id":"d95a6ec1-9656-4f7a-a0b2-b7e74ff5ce81","name":"Agente Laura"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"GPT-4.1-MINI"},"messages":{"values":[{"content":"={{ $json.output }}"},{"content":"En base a la respuesta recibida, determina si la respuesta deberíamos dársela en formato audio o formato texto.\n\nTrata de enviar el 0% de las veces un audio y 100% texto. resérvate el texto para cuando te pida en el mensaje explícitamente que le envíes un texto y para cuando en el mensaje se detalle mucha información sobre el programa, los módulos, etc...\n\nSimplemente responde: \"Audio\" o \"Texto\"","role":"system"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1540,340],"id":"c971f2fe-21f8-4c17-9cd5-5272547900c3","name":"Texto o Audio"},{"parameters":{"resource":"audio","input":"={{ $('Agente Laura').item.json.output }}","voice":"shimmer","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[2360,360],"id":"be35da25-352f-4548-843a-10f1d7586a98","name":"Genera audio"},{"parameters":{"url":"={{ $json.body.message.audioMessage.url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-40,180],"id":"71678eaf-89f4-47c3-b7b0-42126a2c509b","name":"Descarga Audio","alwaysOutputData":true,"executeOnce":false,"notesInFlow":false},{"parameters":{"operation":"toBinary","sourceProperty":"data","options":{"fileName":"audio.mp3","mimeType":"audio/mpeg"}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[180,180],"id":"cfc48cd6-630b-4b34-a5f9-b06c4ff8448f","name":"Convert to File"}],"connections":{"Postgres1":{"ai_tool":[[{"node":"Agente Laura","type":"ai_tool","index":0}]]},"Supabase Vector Store1":{"ai_tool":[[{"node":"Agente Laura","type":"ai_tool","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Supabase Vector Store1","type":"ai_embedding","index":0}]]},"Webhook":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"Agente Laura","type":"ai_memory","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Agente Laura","type":"ai_languageModel","index":0}]]},"Switch":{"main":[[{"node":"Descarga Audio","type":"main","index":0}],[{"node":"Mapeo de mensaje","type":"main","index":0}]]},"OpenAI1":{"main":[[{"node":"Mapeo de mensaje","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Mapeo de mensaje":{"main":[[{"node":"Agente Laura","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"HTTP Request1","type":"main","index":0}],[{"node":"Genera audio","type":"main","index":0}]]},"Agente Laura":{"main":[[{"node":"Texto o Audio","type":"main","index":0}]]},"Texto o Audio":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Genera audio":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]},"Descarga Audio":{"main":[[{"node":"Convert to File","type":"main","index":0}]]},"Convert to File":{"main":[[{"node":"OpenAI1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"6d02f048-8a43-4a5d-92e9-8724b823b8c6","triggerCount":0,"shared":[{"createdAt":"2025-07-04T18:42:57.942Z","updatedAt":"2025-07-04T18:42:57.942Z","role":"workflow:owner","workflowId":"wCyHbUCyK8ozpGVc","projectId":"B3H8EZwaIhSfaZKt"}],"tags":[]}